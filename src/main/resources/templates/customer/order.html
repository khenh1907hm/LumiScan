<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Đặt món - Bàn <span th:text="${tableNumber}">1</span></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .menu-item { transition: all 0.3s ease; }
        .menu-item:hover { transform: translateY(-2px); }
        .cart-item { animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
<!-- Header -->
<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="px-4 py-3">
        <div class="flex justify-between items-center">
            <div class="flex items-center">
                <a href="/" class="mr-3">
                    <i class="fas fa-arrow-left text-indigo-600 text-lg"></i>
                </a>
                <div>
                    <h1 class="text-lg font-bold text-gray-800">Bàn <span th:text="${tableNumber}">1</span></h1>
                    <p class="text-xs text-gray-500">Chọn món và đặt hàng</p>
                </div>
            </div>
            <div class="relative">
                <button onclick="toggleCart()" class="relative">
                    <i class="fas fa-shopping-cart text-indigo-600 text-lg"></i>
                    <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="pb-20">
    <!-- Table Status -->
    <div class="px-4 py-3 bg-white border-b">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600">Bàn đang hoạt động</span>
            </div>
            <span class="text-sm text-gray-500">Cập nhật: <span id="lastUpdate">vừa xong</span></span>
        </div>
    </div>

    <!-- Menu Categories -->
    <div class="px-4 py-3 bg-white border-b">
        <div class="flex space-x-4 overflow-x-auto">
            <button class="category-btn px-4 py-2 bg-indigo-600 text-white rounded-full text-sm whitespace-nowrap"
                    data-category="all">
                Tất cả
            </button>

            <!-- Load categories dynamically -->
            <th:block th:each="cat : ${categories}">
                <button class="category-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap"
                        th:attr="data-category=${cat.id}"
                        th:text="${cat.name}">
                </button>
            </th:block>
        </div>
    </div>

    <!-- Menu Items -->
    <div class="px-4 py-3 space-y-3 bg-gray-50">
        <div th:each="item : ${menuItems}"
             class="menu-item bg-white rounded-lg p-4 shadow-sm"
             th:attr="data-category=${item != null and item.category != null ? item.category.id : 0}">

            <div class="flex items-center justify-between">
                <div class="w-20 h-20 flex-shrink-0 mr-4">
                    <img th:src="@{${item.imageUrl}}" alt="Ảnh món ăn"
                         class="w-full h-full object-cover rounded-lg shadow-sm">
                </div>

                <div class="flex-1">
                    <h3 class="font-semibold text-gray-800" th:text="${item.name}">Tên món</h3>
                    <p class="text-sm text-gray-500 mt-1" th:text="${item.description}">Mô tả món ăn</p>

                    <div class="flex items-center mt-2">
                    <span class="text-lg font-bold text-indigo-600"
                          th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>

                        <span class="ml-2 text-xs text-green-600 bg-green-100 px-2 py-1 rounded"
                              th:if="${item.status?.name() == 'available'}">Có sẵn</span>

                        <span class="ml-2 text-xs text-red-600 bg-red-100 px-2 py-1 rounded"
                              th:unless="${item.status?.name() == 'available'}">Hết hàng</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Cart Sidebar -->
<div id="cartSidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="absolute right-0 top-0 h-full w-80 bg-white shadow-xl">
        <div class="p-4 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-semibold">Giỏ hàng</h3>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto p-4">
            <div id="cartItems" class="space-y-3">
                <!-- Cart items will be added here -->
            </div>
        </div>

        <div class="p-4 border-t bg-gray-50">
            <div class="flex justify-between items-center mb-4">
                <span class="text-lg font-semibold">Tổng cộng:</span>
                <span id="totalPrice" class="text-lg font-bold text-indigo-600">0đ</span>
            </div>
            <button onclick="placeOrder()"
                    class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                Đặt món
            </button>
        </div>
    </div>
</div>

<!-- Floating Cart Button -->
<div class="fixed bottom-4 right-4 z-40">
    <button onclick="toggleCart()"
            class="w-14 h-14 bg-indigo-600 rounded-full shadow-lg flex items-center justify-center relative">
        <i class="fas fa-shopping-cart text-white text-lg"></i>
        <span id="floatingCartCount"
              class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
    </button>
</div>

<!-- JavaScript (giữ nguyên) -->
<script>
    let cart = {};
    let totalPrice = 0;

    // Category filtering
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const category = this.dataset.category;

                // Update button styles
                document.querySelectorAll('.category-btn').forEach(b => {
                    b.className = 'category-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap';
                });
                this.className = 'category-btn px-4 py-2 bg-indigo-600 text-white rounded-full text-sm whitespace-nowrap';

                // Filter menu items
                document.querySelectorAll('.menu-item').forEach(item => {
                    if (category === 'all' || item.dataset.category === category) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
    });

    function increaseQuantity(itemId) {
        const quantity = parseInt(document.getElementById(`quantity-${itemId}`).textContent);
        document.getElementById(`quantity-${itemId}`).textContent = quantity + 1;
        updateCart(itemId, quantity + 1);
    }

    function decreaseQuantity(itemId) {
        const quantity = parseInt(document.getElementById(`quantity-${itemId}`).textContent);
        if (quantity > 0) {
            document.getElementById(`quantity-${itemId}`).textContent = quantity - 1;
            updateCart(itemId, quantity - 1);
        }
    }

    function updateCart(itemId, quantity) {
        if (quantity === 0) {
            delete cart[itemId];
        } else {
            cart[itemId] = quantity;
        }
        updateCartDisplay();
    }

    function updateCartDisplay() {
        const cartCount = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
        document.getElementById('cartCount').textContent = cartCount;
        document.getElementById('floatingCartCount').textContent = cartCount;

        const cartItems = document.getElementById('cartItems');
        cartItems.innerHTML = '';

        totalPrice = 0;
        Object.keys(cart).forEach(itemId => {
            const itemElement = document.querySelector(`[onclick*="${itemId}"]`).closest('.menu-item');
            const name = itemElement.querySelector('h3').textContent;
            const price = parseInt(itemElement.querySelector('.text-indigo-600').textContent.replace(/[^\d]/g, ''));
            const quantity = cart[itemId];
            totalPrice += price * quantity;

            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item bg-white rounded-lg p-3 shadow-sm';
            cartItem.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <h4 class="font-semibold text-sm">${name}</h4>
                        <p class="text-xs text-gray-500">${price.toLocaleString()}đ</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="decreaseQuantity('${itemId}')" class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center">
                            <i class="fas fa-minus text-gray-600 text-xs"></i>
                        </button>
                        <span class="w-6 text-center text-sm font-semibold">${quantity}</span>
                        <button onclick="increaseQuantity('${itemId}')" class="w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-plus text-white text-xs"></i>
                        </button>
                    </div>
                </div>
            `;
            cartItems.appendChild(cartItem);
        });
        document.getElementById('totalPrice').textContent = totalPrice.toLocaleString() + 'đ';
    }

    function toggleCart() {
        document.getElementById('cartSidebar').classList.toggle('hidden');
    }

    function placeOrder() {
        if (Object.keys(cart).length === 0) {
            alert('Vui lòng chọn món trước khi đặt hàng!');
            return;
        }
        alert('Đặt món thành công!');
        cart = {};
        updateCartDisplay();
        toggleCart();
        document.querySelectorAll('[id^="quantity-"]').forEach(el => el.textContent = '0');
    }

    setInterval(() => {
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
    }, 30000);
</script>
</body>
</html>
